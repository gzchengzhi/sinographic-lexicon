<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinographic Integration Lexicon - Online Query Tool</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #1a252f;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            min-height: 700px;
        }
        
        .sidebar {
            width: 300px;
            background: var(--light);
            padding: 25px;
            border-right: 2px solid #ddd;
        }
        
        .search-box {
            margin-bottom: 30px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .search-box input:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .filter-section {
            margin-bottom: 25px;
        }
        
        .filter-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .filter-select {
            width: 100%;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background: white;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-accent {
            background: var(--accent);
        }
        
        .btn-accent:hover {
            background: #c0392b;
        }
        
        .content-area {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .stat-item {
            text-align: center;
            padding: 0 15px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--secondary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .results-info {
            margin-bottom: 20px;
            color: #666;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .results-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            position: sticky;
            top: 0;
        }
        
        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:hover {
            background: #f9f9f9;
        }
        
        .hanzi-cell {
            font-size: 1.8rem;
            text-align: center;
            font-family: "SimSun", "STKaiti", serif;
        }
        
        .priority-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }
        
        .priority-1 { background: #27ae60; }
        .priority-2 { background: #f39c12; }
        .priority-3 { background: #e67e22; }
        .priority-4 { background: #95a5a6; }
        .priority-5 { background: #7f8c8d; }
        
        .logic-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .converter-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 40px;
        }
        
        .converter-title {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .converter-box {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .converter-input, .converter-output {
            flex: 1;
            min-width: 300px;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
        }
        
        .converter-output textarea {
            background: #f0f0f0;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid #ddd;
            }
        }
        
        @media (max-width: 768px) {
            .results-table {
                display: block;
                overflow-x: auto;
            }
            
            .converter-box {
                flex-direction: column;
            }
            
            .stat-item {
                flex: 1;
                min-width: 120px;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .word-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid var(--secondary);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-hanzi {
            font-size: 2.5rem;
            font-family: "SimSun", "STKaiti", serif;
            margin-right: 15px;
        }
        
        .card-english {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .card-pinyin {
            color: #e74c3c;
            font-style: italic;
        }
        
        .card-example {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.95rem;
            border-left: 3px solid #3498db;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #ffe6e6;
            border: 1px solid #ff9999;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            text-align: center;
            color: #cc0000;
        }
        
        .success-message {
            background: #e6ffe6;
            border: 1px solid #99ff99;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            text-align: center;
            color: #006600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š Sinographic Integration Lexicon</h1>
            <p class="subtitle">Online Query Tool - 1500 English-Chinese Logographic Mappings</p>
            <p class="subtitle">æ•°æ®æº: JSONæ•°æ®åº“å®æ—¶åŠ è½½</p>
        </header>
        
        <div class="main-content">
            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="æœç´¢è‹±æ–‡ã€æ±‰å­—ã€æ‹¼éŸ³æˆ–é‡Šä¹‰...">
                </div>
                
                <div class="filter-section">
                    <h3><i class="fas fa-filter"></i> ç­›é€‰å™¨</h3>
                    
                    <div class="filter-group">
                        <label>ä¼˜å…ˆçº§</label>
                        <select id="priorityFilter" class="filter-select">
                            <option value="all">æ‰€æœ‰ä¼˜å…ˆçº§</option>
                            <option value="1">P1 - æœ€é«˜é¢‘ (500)</option>
                            <option value="2">P2 - é«˜é¢‘ (350)</option>
                            <option value="3">P3 - ä¸­é¢‘ (300)</option>
                            <option value="4">P4 - ä½é¢‘ (200)</option>
                            <option value="5">P5 - ä¸“ä¸š (150)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>è¯æ€§</label>
                        <div class="checkbox-group" id="posFilter">
                            <div class="checkbox-item">
                                <input type="checkbox" id="pos-n" checked>
                                <label for="pos-n">åè¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pos-v" checked>
                                <label for="pos-v">åŠ¨è¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pos-adj" checked>
                                <label for="pos-adj">å½¢å®¹è¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pos-adv" checked>
                                <label for="pos-adv">å‰¯è¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pos-prep" checked>
                                <label for="pos-prep">ä»‹è¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pos-conj" checked>
                                <label for="pos-conj">è¿è¯</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label>è¯­ä¹‰ç±»åˆ«</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="all">æ‰€æœ‰ç±»åˆ«</option>
                            <option value="Nature/Existence">è‡ªç„¶ä¸å­˜åœ¨</option>
                            <option value="People/Society">äººä¸ç¤¾ä¼š</option>
                            <option value="Body/Health">èº«ä½“ä¸å¥åº·</option>
                            <option value="Actions/Changes">åŠ¨ä½œä¸å˜åŒ–</option>
                            <option value="Qualities/Degree">æ€§çŠ¶ä¸ç¨‹åº¦</option>
                            <option value="Relations/Functions">å…³ç³»ä¸åŠŸèƒ½</option>
                            <option value="Modern/Abstract">ç°ä»£æŠ½è±¡æ¦‚å¿µ</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>æ˜ å°„é€»è¾‘</label>
                        <select id="logicFilter" class="filter-select">
                            <option value="all">æ‰€æœ‰ç±»å‹</option>
                            <option value="T1">T1 - ç›´æ¥å¯¹åº”</option>
                            <option value="T2">T2 - è¿‘ä¹‰ä¼˜é€‰</option>
                            <option value="T3">T3 - è¯­ä¹‰æ”¶çª„</option>
                            <option value="T4">T4 - æ–‡åŒ–å€Ÿè¯</option>
                            <option value="T5">T5 - ç³»ç»Ÿç»„åˆ</option>
                            <option value="T0">T0 - ä¿ç•™è‹±æ–‡</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" id="resetFilters">
                    <i class="fas fa-redo"></i> é‡ç½®ç­›é€‰å™¨
                </button>
                
                <div class="filter-section">
                    <h3><i class="fas fa-cogs"></i> æ˜¾ç¤ºé€‰é¡¹</h3>
                    <div class="filter-group">
                        <label>æ˜¾ç¤ºæ¨¡å¼</label>
                        <select id="viewMode" class="filter-select">
                            <option value="table">è¡¨æ ¼è§†å›¾</option>
                            <option value="cards">å¡ç‰‡è§†å›¾</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>æ¯é¡µæ˜¾ç¤º</label>
                        <select id="pageSize" class="filter-select">
                            <option value="25">25 é¡¹</option>
                            <option value="50" selected>50 é¡¹</option>
                            <option value="100">100 é¡¹</option>
                            <option value="500">500 é¡¹</option>
                            <option value="all">å…¨éƒ¨</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-accent" id="exportBtn">
                    <i class="fas fa-download"></i> å¯¼å‡ºå½“å‰ç»“æœ
                </button>
                
                <button class="btn" id="refreshBtn" style="margin-top: 10px;">
                    <i class="fas fa-sync"></i> åˆ·æ–°æ•°æ®
                </button>
            </div>
            
            <!-- ä¸»å†…å®¹åŒº -->
            <div class="content-area">
                <!-- åŠ è½½æç¤º -->
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="spinner"></div>
                    <h3>æ­£åœ¨åŠ è½½æ•°æ®...</h3>
                    <p id="loadingText">ä»JSONæ•°æ®åº“åŠ è½½è¯æ±‡è¡¨</p>
                </div>
                
                <!-- é”™è¯¯æç¤º -->
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                
                <!-- æˆåŠŸæç¤º -->
                <div id="successMessage" class="success-message" style="display: none;"></div>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">æ€»è¯æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="filteredCount">0</div>
                        <div class="stat-label">ç­›é€‰ç»“æœ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="hanziCount">0</div>
                        <div class="stat-label">å”¯ä¸€æ±‰å­—</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="categoriesCount">0</div>
                        <div class="stat-label">ç±»åˆ«æ•°é‡</div>
                    </div>
                </div>
                
                <div class="results-info">
                    æ˜¾ç¤º <span id="showingCount">0</span> ä¸ªç»“æœï¼Œå…± <span id="totalCount2">0</span> ä¸ªè¯æ¡
                    <span id="searchInfo" style="display:none;">ï¼Œæœç´¢è¯: "<span id="searchTerm"></span>"</span>
                </div>
                
                <!-- è¡¨æ ¼è§†å›¾ -->
                <div id="tableView">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>è‹±æ–‡</th>
                                <th>æ±‰å­—</th>
                                <th>æ‹¼éŸ³</th>
                                <th>è¯æ€§</th>
                                <th>ç±»åˆ«</th>
                                <th>ä¼˜å…ˆçº§</th>
                                <th>é€»è¾‘</th>
                                <th>ç¤ºä¾‹</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                            <!-- åŠ¨æ€åŠ è½½æ•°æ® -->
                        </tbody>
                    </table>
                </div>
                
                <!-- å¡ç‰‡è§†å›¾ -->
                <div id="cardView" style="display: none;">
                    <div class="card-view" id="cardsContainer">
                        <!-- åŠ¨æ€åŠ è½½å¡ç‰‡ -->
                    </div>
                </div>
                
                <!-- åˆ†é¡µæ§ä»¶ -->
                <div id="pagination" style="text-align: center; margin-top: 30px;">
                    <button id="prevPage" class="btn" style="width: auto; display: inline-block; margin-right: 10px;">
                        <i class="fas fa-chevron-left"></i> ä¸Šä¸€é¡µ
                    </button>
                    <span id="pageInfo" style="margin: 0 15px;">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                    <button id="nextPage" class="btn" style="width: auto; display: inline-block; margin-left: 10px;">
                        ä¸‹ä¸€é¡µ <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <!-- æ–‡æœ¬è½¬æ¢å™¨ -->
                <div class="converter-section">
                    <h3 class="converter-title">
                        <i class="fas fa-exchange-alt"></i> æ–‡æœ¬è½¬æ¢å™¨
                    </h3>
                    <div class="converter-box">
                        <div class="converter-input">
                            <label>è¾“å…¥è‹±æ–‡æ–‡æœ¬:</label>
                            <textarea id="inputText" placeholder="è¾“å…¥è‹±æ–‡æ–‡æœ¬ï¼Œè½¬æ¢ä¸ºæ··åˆæ–‡å­—...">I love my family and friends. We eat dinner together every day. The sun rises in the east and sets in the west.</textarea>
                            <button class="btn" id="convertBtn" style="margin-top: 10px;">
                                <i class="fas fa-magic"></i> è½¬æ¢æ–‡æœ¬
                            </button>
                        </div>
                        <div class="converter-output">
                            <label>æ··åˆæ–‡å­—è¾“å‡º:</label>
                            <textarea id="outputText" readonly placeholder="è½¬æ¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn btn-accent" id="copyBtn">
                                    <i class="fas fa-copy"></i> å¤åˆ¶åˆ°å‰ªè´´æ¿
                                </button>
                                <button class="btn" id="clearBtn">
                                    <i class="fas fa-trash"></i> æ¸…ç©º
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®ç»Ÿè®¡ -->
                <div class="converter-section" style="margin-top: 30px;">
                    <h3 class="converter-title">
                        <i class="fas fa-chart-bar"></i> æ•°æ®ç»Ÿè®¡
                    </h3>
                    <div id="categoryChart" style="height: 200px; margin-top: 20px;">
                        <!-- å›¾è¡¨å°†é€šè¿‡Canvasç»˜åˆ¶ -->
                        <canvas id="chartCanvas"></canvas>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <div>
                            <h4>ä¼˜å…ˆçº§åˆ†å¸ƒ</h4>
                            <div id="priorityDistribution">
                                <!-- åŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div>
                            <h4>è¯æ€§åˆ†å¸ƒ</h4>
                            <div id="posDistribution">
                                <!-- åŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============== å…¨å±€å˜é‡ ==============
        let lexiconData = null;           // å®Œæ•´çš„è¯æ±‡æ•°æ®
        let filteredData = [];            // ç­›é€‰åçš„æ•°æ®
        let currentPage = 1;              // å½“å‰é¡µç 
        let itemsPerPage = 50;            // æ¯é¡µæ˜¾ç¤ºæ•°é‡
        let currentView = 'table';        // å½“å‰è§†å›¾æ¨¡å¼
        
        // ============== é¡µé¢åŠ è½½ ==============
        document.addEventListener('DOMContentLoaded', function() {
            console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...");
            showLoading("æ­£åœ¨åŠ è½½Sinographic Integration Lexiconæ•°æ®åº“...");
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // åŠ è½½JSONæ•°æ®
            loadLexiconData();
        });
        
        // ============== æ•°æ®åŠ è½½å‡½æ•° ==============
        async function loadLexiconData() {
            try {
                console.log("å¼€å§‹åŠ è½½JSONæ•°æ®...");
                
                // å°è¯•ä»å¤šä¸ªå¯èƒ½çš„è·¯å¾„åŠ è½½JSONæ–‡ä»¶
                const possiblePaths = [
                    'sinographic_lexicon_1500.json',
                    'data/sinographic_lexicon_1500.json',
                    'lexicon.json',
                    './sinographic_lexicon_1500.json',
                    '../sinographic_lexicon_1500.json'
                ];
                
                let data = null;
                let error = null;
                
                for (const path of possiblePaths) {
                    try {
                        console.log(`å°è¯•åŠ è½½: ${path}`);
                        const response = await fetch(path);
                        
                        if (!response.ok) {
                            throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                        }
                        
                        data = await response.json();
                        console.log(`æˆåŠŸä» ${path} åŠ è½½æ•°æ®`);
                        break;
                    } catch (err) {
                        error = err;
                        console.log(`æ— æ³•ä» ${path} åŠ è½½: ${err.message}`);
                        continue;
                    }
                }
                
                if (!data) {
                    // å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å†…è”æ•°æ®
                    console.log("å°è¯•ä½¿ç”¨å†…è”ç¤ºä¾‹æ•°æ®...");
                    data = getSampleData();
                }
                
                // å¤„ç†æ•°æ®
                processLoadedData(data);
                
            } catch (error) {
                console.error("åŠ è½½æ•°æ®å¤±è´¥:", error);
                showError(`æ— æ³•åŠ è½½è¯æ±‡è¡¨æ•°æ®: ${error.message}`);
            }
        }
        
        function processLoadedData(data) {
            try {
                console.log("å¤„ç†åŠ è½½çš„æ•°æ®...");
                
                // æ£€æŸ¥æ•°æ®ç»“æ„
                if (data.metadata && data.lexicon) {
                    // å®Œæ•´JSONæ ¼å¼
                    lexiconData = data.lexicon;
                    console.log(`åŠ è½½å®Œæ•´æ•°æ®: ${lexiconData.length} ä¸ªè¯æ¡`);
                } else if (data.m && data.l) {
                    // å‹ç¼©JSONæ ¼å¼
                    lexiconData = decompressData(data);
                    console.log(`åŠ è½½å¹¶è§£å‹æ•°æ®: ${lexiconData.length} ä¸ªè¯æ¡`);
                } else if (Array.isArray(data)) {
                    // ç®€å•æ•°ç»„æ ¼å¼
                    lexiconData = data;
                    console.log(`åŠ è½½æ•°ç»„æ•°æ®: ${lexiconData.length} ä¸ªè¯æ¡`);
                } else {
                    throw new Error("æ— æ³•è¯†åˆ«çš„æ•°æ®æ ¼å¼");
                }
                
                // ç¡®ä¿æ‰€æœ‰è¯æ¡éƒ½æœ‰å¿…è¦çš„å­—æ®µ
                lexiconData = lexiconData.map((item, index) => {
                    return {
                        id: item.id || index + 1,
                        english: item.english || item[1] || '',
                        hanzi: item.hanzi || item[2] || '(ä¿ç•™)',
                        pinyin: item.pinyin || item[3] || '',
                        pos: item.pos || item[4] || 'n',
                        category: item.category || (item[5] ? expandCategory(item[5]) : 'Unknown'),
                        priority: item.priority || item[6] || 3,
                        logic: item.logic || item[7] || 'T1',
                        meaning_en: item.meaning_en || `meaning of ${item.english || ''}`,
                        meaning_zh: item.meaning_zh || `${item.hanzi || ''}çš„é‡Šä¹‰`,
                        example: item.example || `Example: ${item.english || ''}`,
                        notes: item.notes || `ID: ${item.id || index + 1}`
                    };
                });
                
                // åˆå§‹ç­›é€‰
                filteredData = [...lexiconData];
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStatistics();
                
                // æ›´æ–°æ˜¾ç¤º
                updateDisplay();
                
                // éšè—åŠ è½½æç¤º
                hideLoading();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showSuccess(`æˆåŠŸåŠ è½½ ${lexiconData.length} ä¸ªè¯æ¡ï¼`);
                
            } catch (error) {
                console.error("å¤„ç†æ•°æ®æ—¶å‡ºé”™:", error);
                showError(`æ•°æ®å¤„ç†é”™è¯¯: ${error.message}`);
            }
        }
        
        function decompressData(compressedData) {
            // è§£å‹å‹ç¼©çš„JSONæ•°æ®
            const lexicon = [];
            const categoryMap = {
                'Nat': 'Nature/Existence',
                'Peo': 'People/Society',
                'Bod': 'Body/Health',
                'Act': 'Actions/Changes',
                'Qua': 'Qualities/Degree',
                'Rel': 'Relations/Functions',
                'Mod': 'Modern/Abstract'
            };
            
            if (compressedData.l && Array.isArray(compressedData.l)) {
                compressedData.l.forEach((item, index) => {
                    lexicon.push({
                        id: item[0] || index + 1,
                        english: item[1] || '',
                        hanzi: item[2] || '(ä¿ç•™)',
                        pinyin: item[3] || '',
                        pos: item[4] || 'n',
                        category: categoryMap[item[5]] || item[5] || 'Unknown',
                        priority: item[6] || 3,
                        logic: item[7] || 'T1'
                    });
                });
            }
            
            return lexicon;
        }
        
        function expandCategory(code) {
            const map = {
                'N': 'Nature/Existence',
                'P': 'People/Society',
                'B': 'Body/Health',
                'A': 'Actions/Changes',
                'Q': 'Qualities/Degree',
                'R': 'Relations/Functions',
                'M': 'Modern/Abstract'
            };
            return map[code] || code;
        }
        
        // ============== äº‹ä»¶ç›‘å¬å™¨è®¾ç½® ==============
        function setupEventListeners() {
            console.log("è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...");
            
            // æœç´¢è¾“å…¥
            document.getElementById('searchInput').addEventListener('input', debounce(handleSearch, 300));
            
            // ç­›é€‰å™¨å˜æ›´
            document.getElementById('priorityFilter').addEventListener('change', applyFilters);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('logicFilter').addEventListener('change', applyFilters);
            
            // è¯æ€§å¤é€‰æ¡†
            document.querySelectorAll('#posFilter input').forEach(checkbox => {
                checkbox.addEventListener('change', applyFilters);
            });
            
            // æ¯é¡µæ˜¾ç¤ºæ•°é‡
            document.getElementById('pageSize').addEventListener('change', function() {
                itemsPerPage = this.value === 'all' ? Infinity : parseInt(this.value);
                currentPage = 1;
                updateDisplay();
            });
            
            // è§†å›¾åˆ‡æ¢
            document.getElementById('viewMode').addEventListener('change', function() {
                currentView = this.value;
                updateDisplay();
            });
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetFilters').addEventListener('click', resetFilters);
            
            // å¯¼å‡ºæŒ‰é’®
            document.getElementById('exportBtn').addEventListener('click', exportData);
            
            // åˆ·æ–°æŒ‰é’®
            document.getElementById('refreshBtn').addEventListener('click', function() {
                showLoading("é‡æ–°åŠ è½½æ•°æ®...");
                setTimeout(() => {
                    loadLexiconData();
                }, 500);
            });
            
            // åˆ†é¡µæŒ‰é’®
            document.getElementById('prevPage').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updateDisplay();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredData.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    updateDisplay();
                }
            });
            
            // è½¬æ¢å™¨æŒ‰é’®
            document.getElementById('convertBtn').addEventListener('click', convertText);
            document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
            document.getElementById('clearBtn').addEventListener('click', function() {
                document.getElementById('inputText').value = '';
                document.getElementById('outputText').value = '';
            });
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                // Ctrl+F èšç„¦æœç´¢æ¡†
                if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                
                // ESC æ¸…é™¤æœç´¢
                if (e.key === 'Escape') {
                    document.getElementById('searchInput').value = '';
                    handleSearch();
                }
            });
        }
        
        // ============== ç­›é€‰å’Œæœç´¢å‡½æ•° ==============
        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            applyFilters();
            
            // æ›´æ–°æœç´¢ä¿¡æ¯æ˜¾ç¤º
            const searchInfo = document.getElementById('searchInfo');
            const searchTermSpan = document.getElementById('searchTerm');
            
            if (searchTerm.trim()) {
                searchInfo.style.display = 'inline';
                searchTermSpan.textContent = searchTerm;
            } else {
                searchInfo.style.display = 'none';
            }
        }
        
        function applyFilters() {
            if (!lexiconData) return;
            
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const priority = document.getElementById('priorityFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const logic = document.getElementById('logicFilter').value;
            
            // è·å–é€‰ä¸­çš„è¯æ€§
            const posFilters = {
                'n': document.getElementById('pos-n').checked,
                'v': document.getElementById('pos-v').checked,
                'adj': document.getElementById('pos-adj').checked,
                'adv': document.getElementById('pos-adv').checked,
                'prep': document.getElementById('pos-prep').checked,
                'conj': document.getElementById('pos-conj').checked
            };
            
            // ç­›é€‰æ•°æ®
            filteredData = lexiconData.filter(item => {
                // æœç´¢ç­›é€‰
                if (searchTerm) {
                    const matchesSearch = 
                        item.english.toLowerCase().includes(searchTerm) ||
                        item.hanzi.includes(searchTerm) ||
                        item.pinyin.toLowerCase().includes(searchTerm) ||
                        item.meaning_en.toLowerCase().includes(searchTerm) ||
                        item.meaning_zh.includes(searchTerm) ||
                        item.category.toLowerCase().includes(searchTerm);
                    
                    if (!matchesSearch) return false;
                }
                
                // ä¼˜å…ˆçº§ç­›é€‰
                if (priority !== 'all' && item.priority.toString() !== priority) {
                    return false;
                }
                
                // ç±»åˆ«ç­›é€‰
                if (category !== 'all' && item.category !== category) {
                    return false;
                }
                
                // æ˜ å°„é€»è¾‘ç­›é€‰
                if (logic !== 'all' && item.logic !== logic) {
                    return false;
                }
                
                // è¯æ€§ç­›é€‰
                const pos = item.pos.toLowerCase();
                const posKey = pos.startsWith('adj') ? 'adj' : 
                              pos.startsWith('adv') ? 'adv' :
                              pos.startsWith('prep') ? 'prep' :
                              pos.startsWith('conj') ? 'conj' :
                              pos.startsWith('v') ? 'v' :
                              pos.startsWith('n') ? 'n' : pos;
                              
                if (!posFilters[posKey]) {
                    return false;
                }
                
                return true;
            });
            
            currentPage = 1;
            updateStatistics();
            updateDisplay();
        }
        
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('priorityFilter').value = 'all';
            document.getElementById('categoryFilter').value = 'all';
            document.getElementById('logicFilter').value = 'all';
            document.getElementById('viewMode').value = 'table';
            document.getElementById('pageSize').value = '50';
            
            document.querySelectorAll('#posFilter input').forEach(cb => cb.checked = true);
            
            if (lexiconData) {
                filteredData = [...lexiconData];
                currentPage = 1;
                updateStatistics();
                updateDisplay();
            }
            
            document.getElementById('searchInfo').style.display = 'none';
            showSuccess("ç­›é€‰å™¨å·²é‡ç½®");
        }
        
        // ============== æ˜¾ç¤ºå’Œæ¸²æŸ“å‡½æ•° ==============
        function updateStatistics() {
            if (!lexiconData) return;
            
            const totalCount = lexiconData.length;
            const filteredCount = filteredData.length;
            
            // è®¡ç®—å”¯ä¸€æ±‰å­—æ•°é‡
            const uniqueHanzi = new Set(lexiconData
                .filter(item => item.hanzi !== '(ä¿ç•™)')
                .map(item => item.hanzi)).size;
            
            // è®¡ç®—ç±»åˆ«æ•°é‡
            const uniqueCategories = new Set(lexiconData.map(item => item.category)).size;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('filteredCount').textContent = filteredCount;
            document.getElementById('hanziCount').textContent = uniqueHanzi;
            document.getElementById('categoriesCount').textContent = uniqueCategories;
            
            // æ›´æ–°ç»“æœä¿¡æ¯
            const showingCount = Math.min(filteredCount, itemsPerPage);
            document.getElementById('showingCount').textContent = showingCount;
            document.getElementById('totalCount2').textContent = filteredCount;
            
            // æ›´æ–°å›¾è¡¨
            updateCharts();
        }
        
        function updateDisplay() {
            if (!filteredData || filteredData.length === 0) {
                renderNoResults();
                return;
            }
            
            // è®¡ç®—åˆ†é¡µ
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
            const pageData = filteredData.slice(startIndex, endIndex);
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            document.getElementById('pageInfo').textContent = 
                `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ`;
            
            document.getElementById('prevPage').disabled = currentPage <= 1;
            document.getElementById('nextPage').disabled = currentPage >= totalPages;
            
            // æ ¹æ®è§†å›¾æ¨¡å¼æ˜¾ç¤º
            if (currentView === 'table') {
                document.getElementById('tableView').style.display = 'block';
                document.getElementById('cardView').style.display = 'none';
                renderTableView(pageData);
            } else {
                document.getElementById('tableView').style.display = 'none';
                document.getElementById('cardView').style.display = 'block';
                renderCardView(pageData);
            }
            
            // æ›´æ–°æ˜¾ç¤ºæ•°é‡
            document.getElementById('showingCount').textContent = pageData.length;
        }
        
        function renderNoResults() {
            const tbody = document.getElementById('resultsBody');
            const cardContainer = document.getElementById('cardsContainer');
            
            const noResultsHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯æ¡ã€‚è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶ã€‚
                    </td>
                </tr>
            `;
            
            const noResultsCardHTML = `
                <div style="text-align: center; padding: 40px; color: #666; grid-column: 1/-1;">
                    <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯æ¡ã€‚è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶ã€‚
                </div>
            `;
            
            tbody.innerHTML = noResultsHTML;
            cardContainer.innerHTML = noResultsCardHTML;
        }
        
        function renderTableView(data) {
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                // ç®€å†™ç±»åˆ«åç§°
                const shortCategory = item.category.split('/')[0];
                
                row.innerHTML = `
                    <td>
                        <strong>${escapeHtml(item.english)}</strong><br>
                        <small style="color: #666;">${escapeHtml(item.meaning_en)}</small>
                    </td>
                    <td class="hanzi-cell">${escapeHtml(item.hanzi)}</td>
                    <td>${escapeHtml(item.pinyin)}</td>
                    <td><span class="logic-badge">${escapeHtml(item.pos)}</span></td>
                    <td>${escapeHtml(shortCategory)}</td>
                    <td><span class="priority-badge priority-${item.priority}">P${item.priority}</span></td>
                    <td><span class="logic-badge">${escapeHtml(item.logic)}</span></td>
                    <td><small>${escapeHtml(item.example)}</small></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function renderCardView(data) {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'word-card fade-in';
                
                // ç®€å†™ç±»åˆ«åç§°
                const shortCategory = item.category.split('/')[0];
                
                card.innerHTML = `
                    <div class="card-header">
                        <div style="display: flex; align-items: center;">
                            <div class="card-hanzi">${escapeHtml(item.hanzi)}</div>
                            <div>
                                <div class="card-english">${escapeHtml(item.english)}</div>
                                <div class="card-pinyin">${escapeHtml(item.pinyin)}</div>
                            </div>
                        </div>
                        <span class="priority-badge priority-${item.priority}">P${item.priority}</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <small style="color: #666;">${escapeHtml(item.meaning_en)}</small>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <span class="logic-badge">${escapeHtml(item.pos)}</span>
                        <span class="logic-badge">${escapeHtml(item.logic)}</span>
                        <span style="font-size: 0.8rem; color: #7f8c8d;">${escapeHtml(shortCategory)}</span>
                    </div>
                    <div class="card-example">
                        <strong>ç¤ºä¾‹:</strong> ${escapeHtml(item.example)}
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // ============== æ–‡æœ¬è½¬æ¢åŠŸèƒ½ ==============
        function convertText() {
            if (!lexiconData) {
                showError("è¯æ±‡è¡¨æ•°æ®æœªåŠ è½½ï¼Œæ— æ³•è½¬æ¢æ–‡æœ¬");
                return;
            }
            
            const inputText = document.getElementById('inputText').value;
            const outputTextarea = document.getElementById('outputText');
            
            if (!inputText.trim()) {
                outputTextarea.value = '';
                return;
            }
            
            // åˆ›å»ºå•è¯åˆ°æ±‰å­—çš„æ˜ å°„å­—å…¸
            const wordMap = {};
            lexiconData.forEach(item => {
                if (item.hanzi !== '(ä¿ç•™)') {
                    wordMap[item.english.toLowerCase()] = item.hanzi;
                }
            });
            
            // è½¬æ¢æ–‡æœ¬
            let convertedText = inputText;
            
            // æŒ‰å•è¯é•¿åº¦æ’åºï¼Œä¼˜å…ˆåŒ¹é…é•¿å•è¯
            const sortedWords = Object.keys(wordMap).sort((a, b) => b.length - a.length);
            
            sortedWords.forEach(word => {
                // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å®Œæ•´çš„å•è¯ï¼ˆè€ƒè™‘å¤æ•°å½¢å¼ç­‰ï¼‰
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                convertedText = convertedText.replace(regex, wordMap[word]);
            });
            
            outputTextarea.value = convertedText;
            showSuccess("æ–‡æœ¬è½¬æ¢å®Œæˆï¼");
        }
        
        function copyToClipboard() {
            const outputText = document.getElementById('outputText');
            
            if (!outputText.value.trim()) {
                showError("æ²¡æœ‰å†…å®¹å¯å¤åˆ¶");
                return;
            }
            
            outputText.select();
            outputText.setSelectionRange(0, 99999);
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showSuccess("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
                } else {
                    showError("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶");
                }
            } catch (err) {
                // ä½¿ç”¨æ–°çš„ Clipboard API
                navigator.clipboard.writeText(outputText.value)
                    .then(() => showSuccess("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼"))
                    .catch(() => showError("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶"));
            }
        }
        
        // ============== æ•°æ®å¯¼å‡ºåŠŸèƒ½ ==============
        function exportData() {
            if (!filteredData || filteredData.length === 0) {
                showError("æ²¡æœ‰æ•°æ®å¯å¯¼å‡º");
                return;
            }
            
            const dataToExport = filteredData.map(item => ({
                è‹±æ–‡: item.english,
                æ±‰å­—: item.hanzi,
                æ‹¼éŸ³: item.pinyin,
                è¯æ€§: item.pos,
                ç±»åˆ«: item.category,
                ä¼˜å…ˆçº§: `P${item.priority}`,
                æ˜ å°„é€»è¾‘: item.logic,
                è‹±æ–‡é‡Šä¹‰: item.meaning_en,
                ä¸­æ–‡é‡Šä¹‰: item.meaning_zh,
                ç¤ºä¾‹: item.example
            }));
            
            // è½¬æ¢ä¸ºCSV
            const headers = Object.keys(dataToExport[0]);
            const csvContent = [
                headers.join(','),
                ...dataToExport.map(row => 
                    headers.map(header => 
                        `"${String(row[header] || '').replace(/"/g, '""')}"`
                    ).join(',')
                )
            ].join('\n');
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `sinographic_lexicon_å¯¼å‡º_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess(`å·²å¯¼å‡º ${filteredData.length} ä¸ªè¯æ¡`);
        }
        
        // ============== å›¾è¡¨åŠŸèƒ½ ==============
        function updateCharts() {
            if (!lexiconData) return;
            
            // ç»Ÿè®¡ç±»åˆ«åˆ†å¸ƒ
            const categoryCounts = {};
            const priorityCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0};
            const posCounts = {};
            
            lexiconData.forEach(item => {
                // ç±»åˆ«ç»Ÿè®¡
                categoryCounts[item.category] = (categoryCounts[item.category] || 0) + 1;
                
                // ä¼˜å…ˆçº§ç»Ÿè®¡
                if (item.priority >= 1 && item.priority <= 5) {
                    priorityCounts[item.priority]++;
                }
                
                // è¯æ€§ç»Ÿè®¡
                const pos = item.pos.toLowerCase();
                const posKey = pos.startsWith('adj') ? 'å½¢å®¹è¯' : 
                              pos.startsWith('adv') ? 'å‰¯è¯' :
                              pos.startsWith('prep') ? 'ä»‹è¯' :
                              pos.startsWith('conj') ? 'è¿è¯' :
                              pos.startsWith('v') ? 'åŠ¨è¯' :
                              pos.startsWith('n') ? 'åè¯' : pos;
                
                posCounts[posKey] = (posCounts[posKey] || 0) + 1;
            });
            
            // æ›´æ–°ä¼˜å…ˆçº§åˆ†å¸ƒæ˜¾ç¤º
            const priorityContainer = document.getElementById('priorityDistribution');
            let priorityHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const count = priorityCounts[i];
                const percentage = ((count / lexiconData.length) * 100).toFixed(1);
                priorityHTML += `
                    <div style="margin-bottom: 5px;">
                        <span style="display: inline-block; width: 60px;">P${i}:</span>
                        <div style="display: inline-block; width: 100px; background: #eee; border-radius: 3px;">
                            <div style="width: ${percentage}%; height: 20px; background: var(--secondary); border-radius: 3px;"></div>
                        </div>
                        <span style="margin-left: 10px;">${count} (${percentage}%)</span>
                    </div>
                `;
            }
            priorityContainer.innerHTML = priorityHTML;
            
            // æ›´æ–°è¯æ€§åˆ†å¸ƒæ˜¾ç¤º
            const posContainer = document.getElementById('posDistribution');
            let posHTML = '';
            
            const sortedPos = Object.entries(posCounts).sort((a, b) => b[1] - a[1]);
            
            sortedPos.forEach(([pos, count]) => {
                const percentage = ((count / lexiconData.length) * 100).toFixed(1);
                posHTML += `
                    <div style="margin-bottom: 5px;">
                        <span style="display: inline-block; width: 60px;">${pos}:</span>
                        <div style="display: inline-block; width: 100px; background: #eee; border-radius: 3px;">
                            <div style="width: ${percentage}%; height: 20px; background: var(--accent); border-radius: 3px;"></div>
                        </div>
                        <span style="margin-left: 10px;">${count} (${percentage}%)</span>
                    </div>
                `;
            });
            posContainer.innerHTML = posHTML;
            
            // ç»˜åˆ¶ç±»åˆ«é¥¼å›¾
            drawCategoryChart(categoryCounts);
        }
        
        function drawCategoryChart(categoryCounts) {
            const canvas = document.getElementById('chartCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå¤§å°
            canvas.width = 400;
            canvas.height = 200;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œè¿”å›
            if (Object.keys(categoryCounts).length === 0) return;
            
            // è®¡ç®—æ€»æ•°
            const total = Object.values(categoryCounts).reduce((a, b) => a + b, 0);
            
            // é¢œè‰²
            const colors = [
                '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                '#9b59b6', '#1abc9c', '#34495e'
            ];
            
            // ç»˜åˆ¶å›¾ä¾‹
            let startAngle = 0;
            let legendY = 10;
            let index = 0;
            
            const sortedCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1]);
            
            // ç»˜åˆ¶ç®€å•çš„æ¡å½¢å›¾ï¼ˆæ›¿ä»£é¥¼å›¾ï¼Œæ›´ç®€å•ï¼‰
            const barHeight = 20;
            const barSpacing = 5;
            const maxBarWidth = 200;
            const maxCount = Math.max(...Object.values(categoryCounts));
            
            sortedCategories.forEach(([category, count], i) => {
                const color = colors[i % colors.length];
                const percentage = ((count / total) * 100).toFixed(1);
                const barWidth = (count / maxCount) * maxBarWidth;
                
                // ç»˜åˆ¶æ¡å½¢
                ctx.fillStyle = color;
                ctx.fillRect(10, 10 + i * (barHeight + barSpacing), barWidth, barHeight);
                
                // ç»˜åˆ¶æ–‡æœ¬
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                
                // ç±»åˆ«åç§°ï¼ˆç®€å†™ï¼‰
                const shortCategory = category.split('/')[0];
                ctx.fillText(shortCategory, 10, 8 + i * (barHeight + barSpacing));
                
                // æ•°é‡å’Œç™¾åˆ†æ¯”
                ctx.fillText(`${count} (${percentage}%)`, barWidth + 20, 25 + i * (barHeight + barSpacing));
            });
        }
        
        // ============== å·¥å…·å‡½æ•° ==============
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showLoading(message = "åŠ è½½ä¸­...") {
            const overlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            if (overlay && loadingText) {
                loadingText.textContent = message;
                overlay.style.display = 'flex';
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
            
            console.error(message);
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // ============== ç¤ºä¾‹æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰ ==============
        function getSampleData() {
            console.log("ä½¿ç”¨ç¤ºä¾‹æ•°æ®...");
            return {
                metadata: {
                    name: "Sinographic Integration Lexicon - ç¤ºä¾‹æ•°æ®",
                    version: "1.0",
                    total_words: 100,
                    unique_hanzi: 80,
                    created: new Date().toISOString()
                },
                lexicon: [
                    {id: 1, english: "the", hanzi: "(ä¿ç•™)", pinyin: "", pos: "art", category: "Relations/Functions", priority: 1, logic: "T0"},
                    {id: 2, english: "be", hanzi: "ä¸º", pinyin: "wÃ©i", pos: "v", category: "Actions/Changes", priority: 1, logic: "T2"},
                    {id: 3, english: "to", hanzi: "(ä¿ç•™)", pinyin: "", pos: "prep", category: "Relations/Functions", priority: 1, logic: "T0"},
                    {id: 4, english: "of", hanzi: "ä¹‹", pinyin: "zhÄ«", pos: "prep", category: "Relations/Functions", priority: 1, logic: "T2"},
                    {id: 5, english: "and", hanzi: "å’Œ", pinyin: "hÃ©", pos: "conj", category: "Relations/Functions", priority: 1, logic: "T1"},
                    {id: 6, english: "sun", hanzi: "æ—¥", pinyin: "rÃ¬", pos: "n", category: "Nature/Existence", priority: 1, logic: "T1"},
                    {id: 7, english: "moon", hanzi: "æœˆ", pinyin: "yuÃ¨", pos: "n", category: "Nature/Existence", priority: 1, logic: "T1"},
                    {id: 8, english: "water", hanzi: "æ°´", pinyin: "shuÇ", pos: "n", category: "Nature/Existence", priority: 1, logic: "T1"},
                    {id: 9, english: "fire", hanzi: "ç«", pinyin: "huÇ’", pos: "n", category: "Nature/Existence", priority: 1, logic: "T1"},
                    {id: 10, english: "person", hanzi: "äºº", pinyin: "rÃ©n", pos: "n", category: "People/Society", priority: 1, logic: "T1"},
                    {id: 11, english: "love", hanzi: "çˆ±", pinyin: "Ã i", pos: "v", category: "Actions/Changes", priority: 1, logic: "T1"},
                    {id: 12, english: "see", hanzi: "è§", pinyin: "jiÃ n", pos: "v", category: "Actions/Changes", priority: 1, logic: "T1"},
                    {id: 13, english: "big", hanzi: "å¤§", pinyin: "dÃ ", pos: "adj", category: "Qualities/Degree", priority: 1, logic: "T1"},
                    {id: 14, english: "small", hanzi: "å°", pinyin: "xiÇo", pos: "adj", category: "Qualities/Degree", priority: 1, logic: "T1"},
                    {id: 15, english: "good", hanzi: "å¥½", pinyin: "hÇo", pos: "adj", category: "Qualities/Degree", priority: 1, logic: "T1"}
                ]
            };
        }
    </script>
</body>
</html>
